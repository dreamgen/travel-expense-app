# 🏖️ 員工旅遊費用申請與審核系統

一個專為員工旅遊設計的**前後端整合解決方案**。前端為 PWA (Progressive Web App)，讓員工在旅遊途中輕鬆記錄費用；後端為 Google Apps Script，提供雲端審核、資料同步與管理功能。

## ✨ 主要功能

### 📱 前端 APP (員工端)
*   **🚀 零設定開局**：內建 API 連線設定，免手動輸入網址，開箱即用。
*   **👥 身分分流**：
    *   **團長**：一鍵開團、產生邀請碼、管理團員。
    *   **團員**：輸入代碼加入、專注個人記帳。
*   **📸 快速記錄**：拍照上傳單據，支援離線暫存。
*   **☁️ 智慧同步**：
    *   **跨裝置同步**：支援「上傳」與「下載」功能，換手機也能繼續編輯。
    *   **衝突解決**：自動偵測版本與同名衝突，避免資料覆蓋。
*   **💰 多幣別支援**：支援 TWD, USD, JPY, EUR, CNY 等，自動換算匯率。
*   **📊 即時狀態**：團員可直接看到費用審核狀態（通過/退回/需補件）。

### 🛡️ 管理後台 (團長/財務端)
*   **📋 案件總覽**：查看所有員工的申請狀態（待審、通過、退回）。
*   **🔎 逐筆審核**：針對每一筆費用進行審核，可標記「需補件」或「退回」。
*   **🔒 鎖定機制**：
    *   **案件鎖定**：結案後鎖定案件，防止員工誤改。
    *   **解鎖功能**：特殊情況可解鎖讓員工重新上傳。
*   **📧 自動通知**：審核退回或需補件時，自動發信通知管理員。

---

## 🚀 部署指南

本系統分為 **後端 (Google Apps Script)** 與 **前端 (GitHub Pages / Static Host)** 兩部分。

### Step 1: 部署後端 (Google Apps Script)

1.  建立一個新的 Google Sheet。
2.  點擊 `擴充功能` > `Apps Script`。
3.  將專案中 `gas/` 資料夾內的 `Code.gs` 內容複製貼上。
4.  設定 **指令碼屬性 (Script Properties)**：
    *   `ADMIN_PASSWORD`: 設定管理後台登入密碼。
    *   `PHOTO_FOLDER_ID`: (選填) 指定 Google Drive 照片上傳資料夾 ID。
    *   `ADMIN_EMAIL`: (選填) 接收審核通知的管理員 Email。
5.  點擊 `部署` > `新增部署` > `網頁應用程式`。
    *   **執行身分**：我 (Me)
    *   **存取權限**：任何人 (Anyone)
6.  複製取得的 **Web App URL**。

### Step 2: 部署前端 (GitHub Pages)

1.  開啟專案根目錄下的 `config.json` 檔案。
2.  將 `gas_webapp_url` 欄位更新為您在 Step 1 取得的 URL。
    ```json
    {
      "gas_webapp_url": "https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec"
    }
    ```
3.  將本專案上傳至 GitHub。
4.  開啟 GitHub Pages 功能，以 `root` 或 `docs` 資料夾發布。

---

## 📱 使用說明

### 📱 使用說明 (User Guide)

#### 1. 初始設定 (Onboarding)
系統採用 **零設定開局 (Zero-Config)**，使用者無需手動輸入 API 網址。首次進入 APP 時，請依照身份選擇：

*   **👑 我是團長 (Leader)**：
    *   點擊建立新旅遊，系統將自動產生一組 `Trip Code`（如 `TRIP-1234`）。
    *   複製此代碼並分享給所有團員。
    *   可在「旅遊」頁面管理團員名單、備份全團資料。

*   **👤 我是團員 (Member)**：
    *   輸入團長提供的 `Trip Code` 加入旅遊。
    *   系統將自動同步團長設定的旅遊資訊。

#### 2. 常見操作
*   **記帳與拍照**：在首頁點擊 `+` 新增費用，支援離線操作。
*   **雲端同步**：
    *   **上傳**：點擊「上傳至雲端」備份個人費用。
    *   **更新**：點擊「下載更新」取得最新審核狀態（通過/退回）。
*   **狀態查詢**：團員可即時查看審核進度（綠燈=通過，紅燈=退回）。

#### 3. 結案與重設
*   **結案鎖定**：團長確認完畢後可鎖定案件，防止資料被誤改。
*   **重設/離開**：若輸入錯誤代碼或旅遊結束，可至「設定」頁面最下方點擊「離開/重設旅遊」回到初始畫面。

### 管理端 (Admin Dashboard)
1.  開啟 `admin/index.html` 頁面（例如 `https://your-site.com/admin/`）。
2.  輸入 **Web App URL** 與 **管理員密碼** 登入。
3.  **審核流程**：
    *   點擊案件進入詳情。
    *   針對每筆費用點擊「通過」、「退回」或「備註」。
    *   若有退回/補件，系統會自動發送通知信。
4.  **結案鎖定**：在詳情頁下方點擊「🔒 鎖定案件」，員工端將無法再變更資料。

---

## 🛠️ 技術架構

*   **Frontend**: Native JavaScript (ES6+), Tailwind CSS, PWA, IndexedDB
*   **Backend**: Google Apps Script (GAS)
*   **Database**: Google Sheets (作為資料庫), Google Drive (圖片儲存)
*   **Authentication**: 自定義簡易 Token 驗證 (Admin)

---

## ⚠️ 注意事項

1.  **GAS 限制**：Google 免費帳戶每日 Email 發送額度為 100 封。
2.  **圖片備份**：上傳之照片會儲存於 Google Drive，請定期備份。
3.  **瀏覽器快取**：前端大幅依賴 LocalStorage 與 Service Worker，若發生異常可嘗試「清除瀏覽器資料」。

---

**版本**: v2.0 (整合版) - 含零設定開局、身分分流與完整生命週期管理
**開發者**: DreamGen Team
